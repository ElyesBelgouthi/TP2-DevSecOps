rules:
  - id: missing-auth-check-in-handler
    patterns:
      - pattern-either:
          - pattern: |
              router.$METHOD('/admin', ($REQ, $RES) => { ... })
          - pattern: |
              router.$METHOD('/$PATH/admin', ($REQ, $RES) => { ... })
      - pattern-not-inside: |
          if ($REQ.headers.authorization) { ... }
      - pattern-not-inside: |
          if ($REQ.user) { ... }
      - pattern-not-inside: |
          if ($REQ.isAuthenticated()) { ... }
    message: Route admin sans v√©rification d'authentification dans le handler
    languages: [javascript, typescript]
    severity: ERROR
    metadata:
      category: security
      cwe: "CWE-306: Missing Authentication for Critical Function"